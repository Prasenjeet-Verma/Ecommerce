<!DOCTYPE html>
<html>
<head>
  <title>Cancelled Orders</title>
  <link rel="stylesheet" href="/css/admin-newoder.css">
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>

<body>

      <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="toggleSidebar()"
    ></div>

    <header class="mobile-header">
      <span style="font-weight: 800; font-size: 1.2rem"
        ><%-admin.username%></span
      >
      <i
        class="fa-solid fa-bars"
        style="font-size: 1.5rem; cursor: pointer"
        onclick="toggleSidebar()"
      ></i>
    </header>

<%- include("../partials/adminNavBar") %>

<main class="main-content">

<h1>❌ Cancelled Orders</h1>
<p>Orders cancelled by users or admin</p>

<table>
  <thead>
    <tr>
      <th>Order ID</th>
      <th>User</th>
      <th>Products</th>
      <th>Total</th>
      <th>Cancelled By</th>
      <th>Reason</th>
      <th>Date</th>
    </tr>
  </thead>

  <tbody>

  <% if (orders.length === 0) { %>
    <tr>
      <td colspan="7" style="text-align:center;padding:20px;">
        No Cancelled Orders
      </td>
    </tr>
  <% } %>

  <% orders.forEach(order => { %>
    <tr>

      <!-- Order ID -->
      <td>#<%= order._id.toString().slice(-6).toUpperCase() %></td>

      <!-- User -->
      <td>
        <%= order.user?.username || "Guest" %><br>
        <small><%= order.user?.phoneNo || order.mobile %></small>
      </td>

      <!-- Products -->
      <td>
        <% order.items.forEach(item => { %>
          <div style="display:flex;gap:10px;margin-bottom:8px;align-items:center;">
            <img src="<%= item.product.images[0] %>" width="45" style="border-radius:6px;">
            <div>
              <strong><%= item.product.title %></strong><br>
              <small>Qty: <%= item.qty %> <% if(item.size){ %> | Size: <%= item.size %> <% } %></small>
            </div>
          </div>
        <% }) %>
      </td>

      <!-- Total -->
      <td>₹<%= order.totalAmount %></td>

      <!-- Cancelled By -->
      <td>
        <% if(order.cancelled.cancelledBy === "user"){ %>
          <span style="color:red;font-weight:bold;">User</span>
        <% } else if(order.cancelled.cancelledBy === "admin"){ %>
          <span style="color:blue;font-weight:bold;">Admin</span>
        <% } else { %>
          <span>-</span>
        <% } %>
      </td>

      <!-- Reason -->
      <td>
        <%= order.cancelled.cancelReason || "Not specified" %>
      </td>

      <!-- Date -->
      <td>
        <%= new Date(order.cancelled.cancelledAt).toLocaleDateString("en-IN") %>
      </td>

    </tr>
  <% }) %>

  </tbody>
</table>

</main>

</body>
<script src="/js/shoesProduct.js"></script>
</html>
