<!DOCTYPE html>
<html>
  <head>
    <title>Completed Orders</title>
    <link rel="stylesheet" href="/css/admin-newoder.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="toggleSidebar()"
    ></div>

    <header class="mobile-header">
      <span style="font-weight: 800; font-size: 1.2rem"
        ><%-admin.username%></span
      >
      <i
        class="fa-solid fa-bars"
        style="font-size: 1.5rem; cursor: pointer"
        onclick="toggleSidebar()"
      ></i>
    </header>

    <%- include("../partials/adminNavBar") %>

    <main class="main-content">
      <h1>✅ Completed Orders</h1>
      <p>
        Total Completed Orders: <strong><%= totalCompletedOrders %></strong>
      </p>

      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>User</th>
            <th>Products</th>
            <th>Total</th>
            <th>Payment</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>

        <tbody>
          <% if(orders.length === 0){ %>
          <tr>
            <td colspan="7" style="text-align: center; padding: 20px">
              No Completed Orders
            </td>
          </tr>
          <% } %> <% orders.forEach(order => { %>
          <tr>
            <!-- Order ID -->
            <td>#<%= order._id.toString().slice(-6).toUpperCase() %></td>

            <!-- User -->
            <td>
              <%= order.user?.username || "Guest" %><br />
              <small><%= order.user?.phoneNo || order.mobile %></small>
            </td>

            <!-- Products -->
            <td>
              <% order.items.forEach(item => { %>
              <div
                style="
                  display: flex;
                  gap: 10px;
                  margin-bottom: 8px;
                  align-items: center;
                "
              >
                <img
                  src="<%= item.product.images[0] %>"
                  width="45"
                  style="border-radius: 6px"
                />
                <div>
                  <strong><%= item.product.title %></strong><br />
                  <small
                    >Qty: <%= item.qty %> <% if(item.size){ %> | Size: <%=
                    item.size %> <% } %></small
                  >
                </div>
              </div>
              <% }) %>
            </td>

            <!-- Total -->
            <td>₹<%= order.totalAmount %></td>

            <!-- Payment -->
            <td>
              <%= order.paymentMethod %> <br />
              <small><%= order.paymentStatus %></small>
            </td>

            <!-- Status -->
            <td>
              <span style="color: green; font-weight: bold">Delivered</span>
            </td>

            <!-- Date -->
            <td>
              <%= new Date(order.createdAt).toLocaleDateString("en-IN") %>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </main>
    <script src="/js/shoesProduct.js"></script>
  </body>
</html>
