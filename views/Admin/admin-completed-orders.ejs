<!DOCTYPE html>
<html>
<head>
  <title>Completed Orders</title>
  <link rel="stylesheet" href="/css/admin-newoder.css">
</head>

<body>

<%- include("../partials/adminNavBar") %>

<main class="main-content">

<h1>✅ Completed Orders</h1>
<p>Total Completed Orders: <strong><%= totalCompletedOrders %></strong></p>

<table>
  <thead>
    <tr>
      <th>Order ID</th>
      <th>User</th>
      <th>Products</th>
      <th>Total</th>
      <th>Payment</th>
      <th>Status</th>
      <th>Date</th>
    </tr>
  </thead>

  <tbody>
  <% if(orders.length === 0){ %>
    <tr>
      <td colspan="7" style="text-align:center;padding:20px;">
        No Completed Orders
      </td>
    </tr>
  <% } %>

  <% orders.forEach(order => { %>
    <tr>
      <!-- Order ID -->
      <td>#<%= order._id.toString().slice(-6).toUpperCase() %></td>

      <!-- User -->
      <td>
        <%= order.user?.username || "Guest" %><br>
        <small><%= order.user?.phoneNo || order.mobile %></small>
      </td>

      <!-- Products -->
      <td>
        <% order.items.forEach(item => { %>
          <div style="display:flex;gap:10px;margin-bottom:8px;align-items:center;">
            <img src="<%= item.product.images[0] %>" width="45" style="border-radius:6px;">
            <div>
              <strong><%= item.product.title %></strong><br>
              <small>Qty: <%= item.qty %> <% if(item.size){ %> | Size: <%= item.size %> <% } %></small>
            </div>
          </div>
        <% }) %>
      </td>

      <!-- Total -->
      <td>₹<%= order.totalAmount %></td>

      <!-- Payment -->
      <td>
        <%= order.paymentMethod %> <br>
        <small><%= order.paymentStatus %></small>
      </td>

      <!-- Status -->
      <td>
        <span style="color:green;font-weight:bold;">Delivered</span>
      </td>

      <!-- Date -->
      <td>
        <%= new Date(order.createdAt).toLocaleDateString("en-IN") %>
      </td>
    </tr>
  <% }) %>
  </tbody>
</table>

</main>
</body>
</html>
