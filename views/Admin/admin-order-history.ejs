<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Order History | Rider Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/admin-newoder.css"/>
</head>

<body>

<header class="mobile-header">
  <span style="font-weight:800;font-size:1.2rem">Rider Admin</span>
  <i class="fa-solid fa-bars" onclick="toggleSidebar()"></i>
</header>

<%- include('../partials/adminNavBar') %>

<main class="main-content">

  <h1>Order History</h1>
  <p>All delivered & cancelled orders</p>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ORDER ID</th>
          <th>CUSTOMER</th>
          <th>PRODUCTS</th>
          <th>PRICE</th>
          <th>STATUS</th>
          <th>DATE</th>
          <th>ACTION</th>
        </tr>
      </thead>

      <tbody>
        <% if (orders.length === 0) { %>
          <tr>
            <td colspan="7" style="text-align:center;">No order history found</td>
          </tr>
        <% } %>

        <% orders.forEach(order => { %>
          <tr>
            <td>#<%= order._id.toString().slice(-6).toUpperCase() %></td>

            <!-- CUSTOMER -->
            <td>
              <div class="customer-info">
                <div class="avatar">
                  <%= order.user.username.charAt(0).toUpperCase() %>
                </div>
                <div>
                  <strong><%= order.user.username %></strong><br>
                  <small><%= order.paymentMethod %></small>
                </div>
              </div>
            </td>

            <!-- PRODUCTS -->
            <td>
              <% order.items.forEach(i => { %>
                <div style="margin-bottom:4px;">
                  <b><%= i.product.title %></b>
                  <% if(i.size){ %>
                    (Size: <%= i.size %>)
                  <% } %>
                  × <%= i.qty %>
                </div>
              <% }) %>
            </td>

            <!-- PRICE -->
            <td><b>₹<%= order.totalAmount %></b></td>

            <!-- STATUS -->
            <td>
              <% if(order.orderStatus === "Delivered"){ %>
                <span class="badge badge-delivered">Delivered</span>
              <% } else { %>
                <span class="badge badge-cancelled">Cancelled</span>
              <% } %>
            </td>

            <!-- DATE -->
            <td>
              <%= new Date(order.createdAt).toLocaleDateString("en-IN") %>
            </td>

            <!-- ACTION -->
            <td>
              <a href="/admin-seeuseralldetails/<%= order.user._id %>">
                <button class="btn-view" style="margin-top:6px;">
                  View Profile
                </button>
              </a>
            </td>

          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

</main>

<script>
function toggleSidebar() {
  document.getElementById("sidebar").classList.toggle("active");
}
</script>

</body>
</html>
